# PlantUMLPharoGizmo
Pharo support for PlantUML.

> Note: The GUI part of this project was initially done in Spec 2, which works best in Pharo 8. However, the baseline will load a GUI that works with Pharo 7. 

[![Demo video of prototype](http://img.youtube.com/vi/fHCcYSa6VhU/0.jpg?1)](https://www.youtube.com/watch?v=fHCcYSa6VhU "Demo of PlantUML Gizmo prototype in Pharo with Spec GUI")

## Important note regarding PlantUML.com's server

Rendering big diagrams [does not always work with PlantUML.com's server](https://github.com/fuhrmanator/PlantUMLPharoGizmo/issues/2), especially with the URLs generated by Pharo, which have less compression than those generated in Javascript or Python. As a workaround, we recommend cloning and [running the PlantUML server locally](https://github.com/plantuml/plantuml-server#how-to-run-the-server), which puts the server on `localhost:8080`.

## Loading

```Smalltalk
Metacello new
  repository: 'github://fuhrmanator/PlantUMLPharoGizmo/src';
  baseline: 'PUGizmo';
  load.
```

## Example

### Class diagrams using a Moose Java model

One reason to get PlantUML working in Pharo was to use it with Moose, and there is now a Moose browser. **Prerequisite:** A generated MSE file for the sample project [FactoryVariants](https://github.com/fuhrmanator/FactoryVariants) was already loaded in Moose.

![Screenshot of Moose browser](https://user-images.githubusercontent.com/7606540/60876935-217c2680-a23d-11e9-8a3d-5f17149ed15a.png) 

Here's the SVG of the diagram shown in the screenshot above, rendered from the PlantUML source that you can copy from the browser and render at PlantUML.com:

![Class diagram](https://www.plantuml.com/plantuml/svg/tLZHQi8m57tlLuJkMTbUWuZWdeVW6EpncjwsmIOjoNMWxEENYfjMky5CLiFeKsbpxhddt9o6pYo1eOsg4el4D2Yq3GXSOWC6g3QCywIK6J9K3MsPGhL2OnChe4Bsa5IO4wEQ6LcKn39fK92iTMBNKhS8Ygr0h0jJRtGshok7HmQqAs5GqybRhkOQ2Zn_-Iw_Rwz4L60jIqk4B9V64kSPMbcunKHejEKy1-7ORZblv6u7kU9yNae1HRrexvVk6QO-C4lQLZWl4Itk4GE0LQ02GIsmQT3KMWR2Uy6Ya3vzFcA3EdCM-wh_zEgF4CQwJnm_rmue8GmxG7bxvRlKmvlz-cUqz6ZacyEukZgRl8z6_lbmZN0UfIy7yoO4ZXDzY_BdM-4M73fxQD0XxERRKBttPUBGjOUVkc-oT-3olhDsZ4is7a-zCuznbaucmY0GskaqPR_ar8DuDQsBeVGbrtSC-UVqlhPLVCO6e_O7kfs5GdJYnSxlDDKYj3SaFVyKxdpq8r6hvqZWowpRPXIK0eiLBD52IHLRnFOVkI9HAp2hi9A5JAn0UlrCQUQQRtyZVW00)

#### Programmatic usage

There's a utility method to generate PlantUML source for a Java model in Moose. 

```Smalltalk
| classes pUMLSource commaFlag |
classes := (MooseModel root first allClasses reject:#isStub) 
  select: [:c | c mooseName beginsWith: 'headfirst::designpatterns::factory::pizzaaf'].
pUMLSource := PUGizmo plantUMLSourceForMooseJavaClasses: classes.
key := pUMLSource asPlantUMLKey.
"using a local server"
serverUrl := 'http://localhost:8080/plantuml/img/', key .
imageMorph := (ZnEasy getPng: serverUrl asUrl) asAlphaImageMorph .
imageMorph layout: #scaledAspect.
w := imageMorph openInWindow.
w center; fitInWorld.
```

![Class diagram](https://www.plantuml.com/plantuml/svg/pLTDJ-Cm4BtdLrZz1rnzGfHbjGUW8jLAUvnrfhQ5lpHs4FJNh-iKk73fP2LpIvJCpFFulJVsTIv0PVPko5X408yvWS8H4n2KI4BAmTW91VfKteH7_nSf3rc1Gt4rE3mKKQ8WgqqHaoLKnSOms52G3ZMHs1Y4wM0f5oadp5Q71AL-35dA-aCjyIPbiiSZm47AtwYrnRmPb8ESBmpUkTdlew-mHvWLReJroQ77KBAuA54BPwzXQn0pyfPmHvZDre7FVFGjd5NzXzR9GIZyskVzOrM_1xAXikw_R1u7m09-TthT27mj6AOBQxTOLks5DEjhSqcxmvIGOh0ytZwTMWSXdhdFvswBPq4OKsMFCkkvozPzaorJzl68ePlkjyOgqB4nQApVS0q5Mm8MZ8S_lH6CpYgSFhN0tekF53mddBEX67qV7tvwxq2VydjZmvRcN6xZh5V8kOMp4DmuKC-FphxW2ZMkQS5Fe4h4VawsT9v7tLWV29s3ZgDW6QEyq7VXzXl5o_bdjP7_2ffmihNnTyj_AzpiotmyX7L8zJbXjSWzLb-XgcnUVyyJwdkszZ7KcrStprRFVKrx1rJlhX1wsyvoUk6Vmx_crt1TfNAwfVy3)

### Simple class diagram

```smalltalk
plantUMLSource := ('@startuml' , String cr ,
'skinparam style strictuml' , String cr ,
'skinparam backgroundcolor transparent' , String cr ,
'skinparam classbackgroundcolor Yellow/LightYellow' , String cr ,
'class Banana' , String cr ,
'note right #red: Ceci n''est pas\nune banane. ' , String cr ,
'@enduml').

codePart := plantUMLSource plantDeflateAndEncode.

serverUrl := 'https://www.plantuml.com/plantuml/img/', codePart.
(ZnEasy getPng: serverUrl) asMorph openInWindow.

"Get the Source back from a URL"
recoveredSource := serverUrl plantUrlStringToPlantSourceString.

self assert: recoveredSource equals: plantUMLSource.
```

![Class diagram](https://www.plantuml.com/plantuml/svg/NOv12i9034LFC7S8kEXEzwwARhs0u2REX3eqpPGaWtXxeswaVFW4teEVqHpL-yB9vYehAYvW_cAArfetv8vvdhHrARbnKt15iK0a_cTbHhEjUYNczZnSwlJmtvs-7fnG8acQ4-Y7mawf7E5CkO8CP0uhsaswKEo7Itj88qc9rzu0)

### Mind map

```smalltalk
plantUMLSource := Character cr join: #('@startmindmap' '* Debian' '** Ubuntu' '*** Linux Mint' '*** Kubuntu' '*** Lubuntu' '*** KDE Neon' '** LMDE' '** SolydXK' '** SteamOS' '** Raspbian with a very long name' '*** <s>Raspmbc</s> => OSMC' '*** <s>Raspyfi</s> => Volumio' '@endmindmap').

codePart := plantUMLSource plantDeflateAndEncode.

serverUrl := 'https://www.plantuml.com/plantuml/img/', codePart.
(ZnEasy getPng: serverUrl) asMorph openInWindow.
```

![Mind map](https://www.plantuml.com/plantuml/svg/JOzD3e8m44PFq3lCkXilW8H4M06II3Hk1waw2PqIsggzlRJ6XDMyoPkVV8Lrk3XDF6gSXOHI3OGif8JpuDdvbIGqnFu3BR5BRUqtQiDrMS5HcRJTj6KLQs-cC5xhX4wXxlg89xHp_0DlSaz0UAabm6Ju0OnQfMEPpUEK7cxPpkQmpw7hsyDMXJlzrSLCNfCHXLfp_B9y0G00)
